<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marketing Quiz</title>
    <style>
        :root { --primary: #2563eb; --bg: #f1f5f9; --text: #1e293b; }
        body { font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; justify-content: center; min-height: 100vh; }
        .container { width: 100%; max-width: 700px; padding: 20px; position: relative; }
        .card { background: white; padding: 2.5rem; border-radius: 1.5rem; box-shadow: 0 10px 30px rgba(0,0,0,0.08); min-height: 400px; display: flex; flex-direction: column; }
        .hidden { display: none; }
        h2 { text-align: center; color: var(--primary); margin-top: 0; }
        
        /* 問題文のスタイル */
        .question-text { font-size: 1.25rem; line-height: 2; margin: 40px 0; color: #334155; }
        
        /* 空欄ボックスのスタイル */
        .blank-box {
            display: inline-block;
            min-width: 120px;
            height: 2.2rem;
            background: white;
            border: 2px solid #cbd5e1;
            border-radius: 6px;
            vertical-align: middle;
            margin: 0 5px;
            cursor: pointer;
            text-align: center;
            line-height: 2.2rem;
            font-weight: bold;
            color: var(--primary);
            transition: all 0.2s;
        }
        .blank-box:hover { border-color: var(--primary); background: #f8fafc; }
        .blank-box.filled { border-color: var(--primary); background: #eff6ff; }

        /* ナビゲーションボタン */
        .nav-controls { display: flex; justify-content: space-between; margin-top: auto; padding-top: 20px; }
        .btn { padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-nav { background: #64748b; color: white; }
        .btn-nav:disabled { opacity: 0.3; cursor: not-allowed; }
        .btn-main { background: var(--primary); color: white; }

        /* 選択肢モーダル/エリア */
        .choices-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); display: none; justify-content: center; align-items: center; z-index: 100; }
        .choices-card { background: white; padding: 20px; border-radius: 12px; width: 90%; max-width: 400px; max-height: 80vh; overflow-y: auto; }
        .choice-item { width: 100%; text-align: left; padding: 12px; margin: 5px 0; border: 1px solid #e2e8f0; border-radius: 8px; background: white; cursor: pointer; }
        .choice-item:hover { background: #f1f5f9; border-color: var(--primary); }

        .status-header { text-align: center; font-weight: bold; color: #94a3b8; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="container">
    <div id="app" class="card">
        </div>
</div>

<div id="choices-overlay" class="choices-overlay" onclick="closeChoices()">
    <div class="choices-card" onclick="event.stopPropagation()">
        <h3 style="margin-top:0">答えを選択</h3>
        <div id="choices-list"></div>
    </div>
</div>

<script>
// データ（管理番号idは保持しますが、画面には出しません）
const quizData = [
    { id: 1, q: "懸賞を用いた販売促進では、誰にでも当選の可能性のある「 」キャンペーンと特定の条件を満たした人のみが当たる可能性のある「 」キャンペーンがある。", a: ["オープン", "クローズト"] },
    { id: 3, q: "従来の顧客創造型マーケティングとは異なり、新規顧客を開拓するよりも既存の顧客を効率的であり、高収益につながるという考え方に基づくマーケティングを「 」型マーケティングという。", a: ["顧客維持"] },
    { id: 4, q: "既存顧客からの収益アップのしくみは、「 」利益、「 」利益、「 」利益、「 」利益、「 」利益がある。", a: ["基礎", "購買・残高増", "営業費削減", "紹介", "価格プレミアム"] },
    { id: 9, q: "顧客一人ひとりを把握することを前提にしたマーケティングを「 」マーケティングという。", a: ["ワン・トゥ・ワン"] },
    { id: 10, q: "サービスマーケティングの4つの特徴は、「 」、「 」、「 」、「 」である。", a: ["無形性", "同時性", "異質性", "消滅性"] },
    { id: 14, q: "サービスを4種類に分類すると「 」サービス、「 」サービス、「 」サービス、「 」サービスである。", a: ["パーソン・スタンダード", "パーソン・カスタマイズ", "マテリアル・スタンダード", "マテリアル・カスタマイズ"] },
    { id: 18, q: "サービスパッケージの5つの要素は、「 」、「 」、「 」、「 」、「 」である。", a: ["基本サービス", "付加的サービス", "ブランド", "設備", "物的提供物"] },
    { id: 23, q: "従来の４P（PRODUCT/PRICE/PLACE/PROMOTION)に加えて７Pと言われる追加の３Pは「 」、「 」、「 」である。", a: ["people", "process", "physical evidence"] },
    { id: 26, q: "従業員を顧客の一部とみて、ニーズを満たし、好ましい行動を引き出そうとする活動を「 」マーケティングという。", a: ["インターナル"] },
    { id: 27, q: "限られた店舗で最も生産性の高い売り場づくりを目指すことを「 」マーチャンダイジングという。", a: ["インストア"] },
    { id: 28, q: "我々の視覚に訴える店舗のレイアウトや品ぞろえ、什器や備品、POPなどの演出を「 」マーケティングという。", a: ["ヴィジュアル"] },
    { id: 29, q: "スーパーなどで一つのゴンドラの中で売り上げが最大になるような効果的な商品の棚割り計画のことを「 」という。", a: ["プラノグラム"] },
    { id: 30, q: "企業が必要な部品や製品を、必要な時に、必要な場所へ、必要な量だけ届ける配送システムのことを「 」・イン・タイム物流という。", a: ["ジャスト"] },
    { id: 31, q: "どこかで成功したビジネスアイデアを土台にして用いることを「 」という。", a: ["リアプライ"] },
    { id: 32, q: "「 」効果とは、ある製品・サービスを消費する人が多ければ多いほど顧客がその製品・サービスによって得る満足・安心感が増加する効果のことであり、「 」効果とは、他人と同じものは消費したくない、他人とは違うものが欲しいという心理のことである。", a: ["バンドワゴン", "スノッブ"] },
    { id: 34, q: "イノベーター理論では顧客の新製品や新サービスの購入頻度をもとに、「 」、「 」、「 」、「 」、「 」の5つのタイプに分類される。", a: ["イノベーター", "アーリーアダプター", "アーリーマジョリティ", "レイトマジョリティ", "ラガード"] },
    { id: 39, q: "バリューブレイクスルー戦略で、機能型→感性型という逆の価値観を取り入れ成功した企業は「 」である。", a: ["スターバックス"] },
    { id: 40, q: "競争とは関係ない広々とした市場空間を生み出して競争を無意味にする、全く新しい価値曲線を描く戦略のことを「 」戦略という。", a: ["ブルーオーシャン"] },
    { id: 41, q: "オンライン取引を利用することで企業は世界中の消費者をターゲットにすることができ、いわゆるベストセラーでない多様な製品の販売が可能になる。これを「 」効果という。", a: ["ロングテール"] },
    { id: 42, q: "オンライン取引の限界とは「 」、「 」、「 」、「 」である。", a: ["実見性", "応答性", "即時性", "団らん性"] },
    { id: 46, q: "ソーシャル・マーケティングは社会的マーケティングと訳すことができるが、コトラーのソーシャル・マーケティングは「 」のマーケティングとも呼ばれ、レイザーのソーシャル・マーケティングは「 」のマーケティングとも呼ばれる。", a: ["非営利組織", "社会志向"] },
    { id: 48, q: "企業の社会貢献マーケティングにおいて、文化支援活動を「 」、慈善行為を「 」と呼ぶ。", a: ["フィランソロピー", "メセナ"] },
    { id: 50, q: "「 」経営とは、「共有価値の創造」を軸とした経営のことです。", a: ["CSV"] }
];

const allKeywords = [...new Set(quizData.flatMap(d => d.a))].sort();

let state = {
    view: 'menu', // 本番は'start'から
    user: null,
    currentQuiz: [],
    index: 0,
    userChoices: {} // { questionIndex: [answer1, answer2...] }
};

function render() {
    const app = document.getElementById('app');
    
    if (state.view === 'menu') {
        app.innerHTML = `
            <h2>Marketing Quiz</h2>
            <button class="btn btn-main" style="width:100%; margin-bottom:10px;" onclick="initQuiz()">クイズを開始 (ランダム10問)</button>
            <p style="text-align:center; font-size:0.8rem; color:#666;">※ログイン機能は前回同様に実装可能です</p>
        `;
    } else if (state.view === 'quiz') {
        const item = state.currentQuiz[state.index];
        let blankIndex = 0;
        
        // 「 」をボタンに置き換えるロジック
        const formattedQuestion = item.q.replace(/「 」/g, () => {
            const currentVal = (state.userChoices[state.index] && state.userChoices[state.index][blankIndex]) || "";
            const html = `<span class="blank-box ${currentVal ? 'filled' : ''}" onclick="openChoices(${blankIndex})">${currentVal || "？"}</span>`;
            blankIndex++;
            return html;
        });

        app.innerHTML = `
            <div class="status-header">第 ${state.index + 1} / 10 問</div>
            <div class="question-text">${formattedQuestion}</div>
            
            <div class="nav-controls">
                <button class="btn btn-nav" onclick="prev()" ${state.index === 0 ? 'disabled' : ''}>← 前へ</button>
                <button class="btn btn-main" onclick="next()">${state.index === 9 ? '採点する' : '次へ →'}</button>
            </div>
        `;
    } else if (state.view === 'result') {
        // 簡易結果表示
        app.innerHTML = `<h2>結果</h2><button class="btn btn-main" onclick="location.reload()">トップへ</button>`;
    }
}

function initQuiz() {
    state.currentQuiz = [...quizData].sort(() => 0.5 - Math.random()).slice(0, 10);
    state.index = 0;
    state.userChoices = {};
    state.view = 'quiz';
    render();
}

function next() {
    if (state.index < 9) {
        state.index++;
        render();
    } else {
        alert("採点機能は次のステップで詳細実装します。まずは移動を確認してください！");
        state.view = 'menu';
        render();
    }
}

function prev() {
    if (state.index > 0) {
        state.index--;
        render();
    }
}

let activeBlankIndex = null;
function openChoices(bIndex) {
    activeBlankIndex = bIndex;
    const list = document.getElementById('choices-list');
    list.innerHTML = "";
    
    // ダミー選択肢（正解+ランダム4つ程度表示）
    const item = state.currentQuiz[state.index];
    const correct = item.a[bIndex];
    let choices = [correct];
    while(choices.length < 5) {
        let dummy = allKeywords[Math.floor(Math.random() * allKeywords.length)];
        if(!choices.includes(dummy)) choices.push(dummy);
    }
    choices.sort();

    choices.forEach(c => {
        const btn = document.createElement('button');
        btn.className = 'choice-item';
        btn.innerText = c;
        btn.onclick = () => selectChoice(c);
        list.appendChild(btn);
    });

    document.getElementById('choices-overlay').style.display = 'flex';
}

function selectChoice(val) {
    if (!state.userChoices[state.index]) state.userChoices[state.index] = [];
    state.userChoices[state.index][activeBlankIndex] = val;
    closeChoices();
    render();
}

function closeChoices() {
    document.getElementById('choices-overlay').style.display = 'none';
}

render();
</script>
</body>
</html>
